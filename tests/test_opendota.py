import pytest
import os
import json
import ctor

from ggbot.opendota import DotaMatch, PlayerRecentMatch, OpenDotaApi

RECENT_MATCHES_DATA = b'[{"match_id":7525114514,"player_slot":132,"radiant_win":false,"hero_id":123,"start_time":1704570254,"duration":2793,"game_mode":22,"lobby_type":0,"version":null,"kills":7,"deaths":4,"assists":14,"average_rank":34,"xp_per_min":502,"gold_per_min":408,"hero_damage":26547,"tower_damage":4781,"hero_healing":0,"last_hits":120,"lane":null,"lane_role":null,"is_roaming":null,"cluster":274,"leaver_status":0,"party_size":null},{"match_id":6918457174,"player_slot":2,"radiant_win":false,"hero_id":36,"start_time":1671046728,"duration":2827,"game_mode":22,"lobby_type":7,"version":21,"kills":11,"deaths":7,"assists":17,"average_rank":25,"xp_per_min":853,"gold_per_min":575,"hero_damage":52444,"tower_damage":2082,"hero_healing":15203,"last_hits":210,"lane":3,"lane_role":3,"is_roaming":false,"cluster":193,"leaver_status":0,"party_size":5},{"match_id":6918402790,"player_slot":2,"radiant_win":false,"hero_id":53,"start_time":1671043830,"duration":2536,"game_mode":22,"lobby_type":7,"version":null,"kills":8,"deaths":16,"assists":4,"average_rank":31,"xp_per_min":445,"gold_per_min":525,"hero_damage":15064,"tower_damage":9665,"hero_healing":0,"last_hits":227,"lane":null,"lane_role":null,"is_roaming":null,"cluster":191,"leaver_status":0,"party_size":5},{"match_id":6910028431,"player_slot":131,"radiant_win":true,"hero_id":55,"start_time":1670614125,"duration":2185,"game_mode":22,"lobby_type":0,"version":null,"kills":3,"deaths":12,"assists":8,"average_rank":31,"xp_per_min":410,"gold_per_min":301,"hero_damage":14177,"tower_damage":169,"hero_healing":2561,"last_hits":83,"lane":null,"lane_role":null,"is_roaming":null,"cluster":273,"leaver_status":0,"party_size":4},{"match_id":6909982934,"player_slot":3,"radiant_win":false,"hero_id":7,"start_time":1670612213,"duration":1591,"game_mode":22,"lobby_type":0,"version":null,"kills":0,"deaths":9,"assists":5,"average_rank":32,"xp_per_min":322,"gold_per_min":243,"hero_damage":12964,"tower_damage":40,"hero_healing":0,"last_hits":62,"lane":null,"lane_role":null,"is_roaming":null,"cluster":274,"leaver_status":0,"party_size":4},{"match_id":6906739610,"player_slot":132,"radiant_win":true,"hero_id":7,"start_time":1670443005,"duration":2263,"game_mode":22,"lobby_type":0,"version":null,"kills":2,"deaths":9,"assists":7,"average_rank":24,"xp_per_min":276,"gold_per_min":224,"hero_damage":10358,"tower_damage":0,"hero_healing":0,"last_hits":47,"lane":null,"lane_role":null,"is_roaming":null,"cluster":182,"leaver_status":0,"party_size":4},{"match_id":6906691525,"player_slot":1,"radiant_win":false,"hero_id":51,"start_time":1670440672,"duration":2039,"game_mode":4,"lobby_type":0,"version":null,"kills":8,"deaths":11,"assists":14,"average_rank":25,"xp_per_min":379,"gold_per_min":364,"hero_damage":23279,"tower_damage":128,"hero_healing":0,"last_hits":85,"lane":null,"lane_role":null,"is_roaming":null,"cluster":183,"leaver_status":0,"party_size":3},{"match_id":6899997556,"player_slot":4,"radiant_win":true,"hero_id":123,"start_time":1670104627,"duration":2757,"game_mode":22,"lobby_type":7,"version":null,"kills":9,"deaths":4,"assists":13,"average_rank":31,"xp_per_min":661,"gold_per_min":454,"hero_damage":31512,"tower_damage":314,"hero_healing":0,"last_hits":195,"lane":null,"lane_role":null,"is_roaming":null,"cluster":192,"leaver_status":0,"party_size":5},{"match_id":6899934395,"player_slot":4,"radiant_win":true,"hero_id":123,"start_time":1670101449,"duration":2700,"game_mode":22,"lobby_type":7,"version":null,"kills":14,"deaths":9,"assists":30,"average_rank":31,"xp_per_min":799,"gold_per_min":522,"hero_damage":41435,"tower_damage":7746,"hero_healing":0,"last_hits":157,"lane":null,"lane_role":null,"is_roaming":null,"cluster":191,"leaver_status":0,"party_size":5},{"match_id":6899753103,"player_slot":2,"radiant_win":true,"hero_id":42,"start_time":1670093504,"duration":2496,"game_mode":5,"lobby_type":0,"version":null,"kills":10,"deaths":6,"assists":21,"average_rank":31,"xp_per_min":853,"gold_per_min":605,"hero_damage":38395,"tower_damage":9039,"hero_healing":0,"last_hits":248,"lane":null,"lane_role":null,"is_roaming":null,"cluster":273,"leaver_status":0,"party_size":3},{"match_id":6896034103,"player_slot":3,"radiant_win":false,"hero_id":107,"start_time":1669926003,"duration":2678,"game_mode":5,"lobby_type":0,"version":null,"kills":11,"deaths":8,"assists":13,"average_rank":31,"xp_per_min":617,"gold_per_min":404,"hero_damage":22970,"tower_damage":154,"hero_healing":0,"last_hits":136,"lane":null,"lane_role":null,"is_roaming":null,"cluster":188,"leaver_status":0,"party_size":4},{"match_id":6894370489,"player_slot":131,"radiant_win":true,"hero_id":7,"start_time":1669838519,"duration":2617,"game_mode":22,"lobby_type":0,"version":null,"kills":10,"deaths":12,"assists":23,"average_rank":33,"xp_per_min":892,"gold_per_min":418,"hero_damage":31590,"tower_damage":201,"hero_healing":0,"last_hits":70,"lane":null,"lane_role":null,"is_roaming":null,"cluster":183,"leaver_status":0,"party_size":5},{"match_id":6894290643,"player_slot":131,"radiant_win":false,"hero_id":90,"start_time":1669834539,"duration":1937,"game_mode":22,"lobby_type":0,"version":null,"kills":4,"deaths":1,"assists":13,"average_rank":33,"xp_per_min":606,"gold_per_min":370,"hero_damage":8964,"tower_damage":460,"hero_healing":2483,"last_hits":53,"lane":null,"lane_role":null,"is_roaming":null,"cluster":187,"leaver_status":0,"party_size":5},{"match_id":6891087300,"player_slot":4,"radiant_win":true,"hero_id":18,"start_time":1669667098,"duration":2781,"game_mode":4,"lobby_type":0,"version":21,"kills":9,"deaths":10,"assists":12,"average_rank":31,"xp_per_min":771,"gold_per_min":542,"hero_damage":22812,"tower_damage":3901,"hero_healing":195,"last_hits":289,"lane":3,"lane_role":3,"is_roaming":false,"cluster":274,"leaver_status":0,"party_size":4},{"match_id":6891032977,"player_slot":132,"radiant_win":true,"hero_id":85,"start_time":1669664329,"duration":2462,"game_mode":4,"lobby_type":0,"version":null,"kills":1,"deaths":12,"assists":16,"average_rank":31,"xp_per_min":375,"gold_per_min":237,"hero_damage":11458,"tower_damage":20,"hero_healing":1898,"last_hits":35,"lane":null,"lane_role":null,"is_roaming":null,"cluster":185,"leaver_status":0,"party_size":4},{"match_id":6889387051,"player_slot":1,"radiant_win":true,"hero_id":123,"start_time":1669580769,"duration":2451,"game_mode":22,"lobby_type":0,"version":null,"kills":6,"deaths":9,"assists":16,"average_rank":31,"xp_per_min":597,"gold_per_min":384,"hero_damage":27000,"tower_damage":363,"hero_healing":0,"last_hits":122,"lane":null,"lane_role":null,"is_roaming":null,"cluster":184,"leaver_status":0,"party_size":3},{"match_id":6887271791,"player_slot":3,"radiant_win":true,"hero_id":110,"start_time":1669495271,"duration":2439,"game_mode":5,"lobby_type":0,"version":null,"kills":6,"deaths":8,"assists":26,"average_rank":31,"xp_per_min":588,"gold_per_min":445,"hero_damage":37472,"tower_damage":707,"hero_healing":3369,"last_hits":58,"lane":null,"lane_role":null,"is_roaming":null,"cluster":274,"leaver_status":0,"party_size":4},{"match_id":6887198491,"player_slot":130,"radiant_win":false,"hero_id":111,"start_time":1669492218,"duration":2542,"game_mode":22,"lobby_type":0,"version":null,"kills":10,"deaths":5,"assists":19,"average_rank":31,"xp_per_min":647,"gold_per_min":405,"hero_damage":22246,"tower_damage":1784,"hero_healing":22386,"last_hits":118,"lane":null,"lane_role":null,"is_roaming":null,"cluster":273,"leaver_status":0,"party_size":4},{"match_id":6885179502,"player_slot":4,"radiant_win":true,"hero_id":123,"start_time":1669410948,"duration":2697,"game_mode":22,"lobby_type":0,"version":null,"kills":14,"deaths":7,"assists":20,"average_rank":25,"xp_per_min":751,"gold_per_min":431,"hero_damage":24660,"tower_damage":3588,"hero_healing":195,"last_hits":130,"lane":null,"lane_role":null,"is_roaming":null,"cluster":273,"leaver_status":0,"party_size":5},{"match_id":6883241569,"player_slot":131,"radiant_win":true,"hero_id":83,"start_time":1669321324,"duration":2167,"game_mode":4,"lobby_type":0,"version":21,"kills":4,"deaths":6,"assists":4,"average_rank":31,"xp_per_min":332,"gold_per_min":327,"hero_damage":9789,"tower_damage":652,"hero_healing":1051,"last_hits":97,"lane":3,"lane_role":1,"is_roaming":false,"cluster":186,"leaver_status":0,"party_size":4}]'
MATCH_DATA = b'{"players":[{"player_slot":0,"team_number":0,"team_slot":0,"hero_id":74,"item_0":214,"item_1":92,"item_2":65,"item_3":16,"item_4":108,"item_5":110,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":300,"kills":1,"deaths":6,"assists":11,"leaver_status":0,"last_hits":130,"denies":12,"gold_per_min":357,"xp_per_min":544,"level":21,"net_worth":15868,"aghanims_scepter":0,"aghanims_shard":1,"moonshard":0,"hero_damage":21239,"tower_damage":125,"hero_healing":327,"gold":1113,"gold_spent":15835,"ability_upgrades_arr":[5372,5371,5370,5371,5371,5372,5370,5371,5370,6099,5371,5371,5371,5372,7148,5372,5372,5372,5372,5762,5370],"radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":true,"win":0,"lose":1,"total_gold":16618,"total_xp":25323,"kills_per_min":0.021482277121374866,"kda":1.71,"abandons":0,"rank_tier":null,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":357,"pct":0.18077023840712603},"xp_per_min":{"raw":544,"pct":0.3039035892061829},"kills_per_min":{"raw":0.021482277121374866,"pct":0.023316740895991617},"last_hits_per_min":{"raw":2.7926960257787328,"pct":0.33167408959916167},"hero_damage_per_min":{"raw":456.2620837808808,"pct":0.27010741419963324},"hero_healing_per_min":{"raw":7.024704618689581,"pct":0.8648152999738015},"tower_damage":{"raw":125,"pct":0.16688498821063663}}},{"player_slot":1,"team_number":0,"team_slot":1,"hero_id":56,"item_0":96,"item_1":250,"item_2":0,"item_3":20,"item_4":36,"item_5":63,"backpack_0":0,"backpack_1":42,"backpack_2":0,"item_neutral":309,"kills":10,"deaths":13,"assists":14,"leaver_status":0,"last_hits":71,"denies":8,"gold_per_min":376,"xp_per_min":637,"level":23,"net_worth":14644,"aghanims_scepter":0,"aghanims_shard":0,"moonshard":0,"hero_damage":32593,"tower_damage":3813,"hero_healing":0,"gold":614,"gold_spent":15735,"ability_upgrades_arr":[1119,5262,1119,1120,1119,5261,1119,1120,1120,6104,1120,5261,5262,5262,6027,5262,5261,495],"radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":true,"win":0,"lose":1,"total_gold":17502,"total_xp":29652,"kills_per_min":0.21482277121374868,"kda":1.71,"abandons":0,"rank_tier":null,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":376,"pct":0.1765633210719916},"xp_per_min":{"raw":637,"pct":0.43352601156069365},"kills_per_min":{"raw":0.21482277121374865,"pct":0.41565948502364686},"last_hits_per_min":{"raw":1.5252416756176155,"pct":0.06883867577509196},"hero_damage_per_min":{"raw":700.171858216971,"pct":0.5296899632159747},"hero_healing_per_min":{"raw":0,"pct":0.9180241723594325},"tower_damage":{"raw":3813,"pct":0.4435102469784551}}},{"player_slot":2,"team_number":0,"team_slot":2,"hero_id":55,"item_0":116,"item_1":119,"item_2":180,"item_3":1,"item_4":692,"item_5":108,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":1160,"kills":7,"deaths":4,"assists":19,"leaver_status":0,"last_hits":303,"denies":8,"gold_per_min":525,"xp_per_min":684,"level":24,"net_worth":22645,"aghanims_scepter":0,"aghanims_shard":1,"moonshard":0,"hero_damage":26307,"tower_damage":1043,"hero_healing":0,"gold":820,"gold_spent":23015,"ability_upgrades_arr":[5256,5255,5256,5257,5256,5258,5256,5257,5257,5257,5255,5255,5255,560,513,5258,5258,736],"account_id":1406430750,"personaname":"ZAWGATRON","name":null,"last_login":null,"radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":true,"win":0,"lose":1,"total_gold":24438,"total_xp":31840,"kills_per_min":0.15037593984962408,"kda":5.2,"abandons":0,"rank_tier":43,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":525,"pct":0.6761363636363636},"xp_per_min":{"raw":684,"pct":0.6571969696969697},"kills_per_min":{"raw":0.15037593984962405,"pct":0.6060606060606061},"last_hits_per_min":{"raw":6.509129967776584,"pct":0.8560606060606061},"hero_damage_per_min":{"raw":565.1342642320086,"pct":0.5037878787878788},"hero_healing_per_min":{"raw":0,"pct":0.44886363636363635},"tower_damage":{"raw":1043,"pct":0.5871212121212122}}},{"player_slot":3,"team_number":0,"team_slot":3,"hero_id":41,"item_0":158,"item_1":172,"item_2":249,"item_3":116,"item_4":63,"item_5":149,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":1156,"kills":8,"deaths":2,"assists":5,"leaver_status":0,"last_hits":304,"denies":3,"gold_per_min":514,"xp_per_min":780,"level":25,"net_worth":22123,"aghanims_scepter":0,"aghanims_shard":0,"moonshard":0,"hero_damage":21754,"tower_damage":3600,"hero_healing":0,"gold":1723,"gold_spent":22775,"ability_upgrades_arr":[5182,5184,5182,5691,5182,5185,5184,5184,5182,867,5184,5185,5691,5691,6807,5691,5185,6128,6651],"account_id":1270841643,"personaname":"SkroMniK","name":null,"last_login":null,"radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":true,"win":0,"lose":1,"total_gold":23926,"total_xp":36309,"kills_per_min":0.17185821697099893,"kda":4.33,"abandons":0,"rank_tier":23,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":514,"pct":0.3469939202882234},"xp_per_min":{"raw":780,"pct":0.5170006755235307},"kills_per_min":{"raw":0.17185821697099893,"pct":0.4023868498086017},"last_hits_per_min":{"raw":6.530612244897959,"pct":0.49403287547849584},"hero_damage_per_min":{"raw":467.3254564983888,"pct":0.40441342040081063},"hero_healing_per_min":{"raw":0,"pct":0.9671245215041657},"tower_damage":{"raw":3600,"pct":0.5226300382796667}}},{"account_id":1537075652,"player_slot":4,"team_number":0,"team_slot":4,"hero_id":107,"item_0":0,"item_1":119,"item_2":235,"item_3":29,"item_4":127,"item_5":114,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":2192,"kills":6,"deaths":6,"assists":16,"leaver_status":0,"last_hits":208,"denies":6,"gold_per_min":446,"xp_per_min":577,"level":22,"net_worth":18363,"aghanims_scepter":0,"aghanims_shard":0,"moonshard":0,"hero_damage":27737,"tower_damage":641,"hero_healing":0,"gold":738,"gold_spent":20620,"ability_upgrades_arr":[5608,5609,5608,5609,5608,5612,5608,5609,5609,324,5610,5612,5610,5610,977,5610,5612,7661],"personaname":"\xd0\x9c\xd1\x83\xd1\x81\xd0\xb0\xd1\x80\xd0\xb0\xd0\xb1 \xd0\xbb\xd1\x8f\xd0\xb4\xd0\xb8 ALT + F4","name":null,"last_login":null,"radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":true,"win":0,"lose":1,"total_gold":20761,"total_xp":26859,"kills_per_min":0.1288936627282492,"kda":3.14,"abandons":0,"rank_tier":34,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":446,"pct":0.6666666666666666},"xp_per_min":{"raw":577,"pct":0.4782608695652174},"kills_per_min":{"raw":0.1288936627282492,"pct":0.47282608695652173},"last_hits_per_min":{"raw":4.468313641245972,"pct":0.8442028985507246},"hero_damage_per_min":{"raw":595.8539205155746,"pct":0.6594202898550725},"hero_healing_per_min":{"raw":0,"pct":0.4583333333333333},"tower_damage":{"raw":641,"pct":0.5706521739130435}}},{"account_id":68418171,"player_slot":128,"team_number":1,"team_slot":0,"hero_id":64,"item_0":231,"item_1":36,"item_2":254,"item_3":0,"item_4":218,"item_5":206,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":585,"kills":2,"deaths":10,"assists":16,"leaver_status":0,"last_hits":64,"denies":4,"gold_per_min":319,"xp_per_min":496,"level":20,"net_worth":14029,"aghanims_scepter":0,"aghanims_shard":1,"moonshard":0,"hero_damage":17005,"tower_damage":3998,"hero_healing":12948,"gold":2529,"gold_spent":11040,"ability_upgrades_arr":[5298,5299,5299,5297,5299,5300,5299,5297,5297,1040,5297,5300,5298,5298,5298,6661,5300,542],"personaname":"gob","name":null,"last_login":"2023-12-20T20:23:09.198Z","radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":false,"win":1,"lose":0,"total_gold":14849,"total_xp":23088,"kills_per_min":0.04296455424274973,"kda":1.64,"abandons":0,"rank_tier":25,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":319,"pct":0.24265796499555028},"xp_per_min":{"raw":496,"pct":0.3924651438742213},"kills_per_min":{"raw":0.04296455424274973,"pct":0.1432809255413824},"last_hits_per_min":{"raw":1.3748657357679914,"pct":0.22663897953129636},"hero_damage_per_min":{"raw":365.30612244897964,"pct":0.20409374072975378},"hero_healing_per_min":{"raw":278.15252416756175,"pct":0.9976268169682587},"tower_damage":{"raw":3998,"pct":0.7371699792346484}}},{"account_id":91601241,"player_slot":129,"team_number":1,"team_slot":1,"hero_id":12,"item_0":174,"item_1":147,"item_2":114,"item_3":108,"item_4":75,"item_5":63,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":362,"kills":10,"deaths":8,"assists":10,"leaver_status":0,"last_hits":311,"denies":13,"gold_per_min":609,"xp_per_min":812,"level":25,"net_worth":25665,"aghanims_scepter":0,"aghanims_shard":0,"moonshard":0,"hero_damage":30715,"tower_damage":9317,"hero_healing":0,"gold":6660,"gold_spent":23140,"ability_upgrades_arr":[5065,5068,5066,5068,5068,5067,5068,5065,5065,5065,1056,5067,5066,5066,563,5066,5067,564,6851],"personaname":"Bangodus","name":null,"last_login":"2021-04-04T19:00:33.235Z","radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":false,"win":1,"lose":0,"total_gold":28348,"total_xp":37798,"kills_per_min":0.21482277121374868,"kda":2.22,"abandons":0,"rank_tier":41,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":609,"pct":0.5857214680744093},"xp_per_min":{"raw":812,"pct":0.6083459024635495},"kills_per_min":{"raw":0.21482277121374865,"pct":0.5822021116138764},"last_hits_per_min":{"raw":6.680988184747583,"pct":0.45349421820010055},"hero_damage_per_min":{"raw":659.828141783029,"pct":0.5228758169934641},"hero_healing_per_min":{"raw":0,"pct":0.9743589743589743},"tower_damage":{"raw":9317,"pct":0.7370537958773253}}},{"account_id":321350745,"player_slot":130,"team_number":1,"team_slot":2,"hero_id":99,"item_0":50,"item_1":692,"item_2":121,"item_3":108,"item_4":112,"item_5":125,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":2096,"kills":3,"deaths":6,"assists":16,"leaver_status":0,"last_hits":247,"denies":3,"gold_per_min":510,"xp_per_min":558,"level":21,"net_worth":23076,"aghanims_scepter":0,"aghanims_shard":1,"moonshard":0,"hero_damage":40952,"tower_damage":4986,"hero_healing":0,"gold":1051,"gold_spent":21615,"ability_upgrades_arr":[5549,5550,5549,5548,5549,5551,5549,5550,5550,5550,7132,5551,5548,5548,1079,5548,5551,6360],"personaname":"\xd0\xbe\xd0\xb2\xd0\xb5\xd1\x80 \xd0\xbf\xd0\xbe\xd0\xb2\xd0\xb5\xd1\x80","name":null,"last_login":null,"radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":false,"win":1,"lose":0,"total_gold":23740,"total_xp":25974,"kills_per_min":0.0644468313641246,"kda":2.71,"abandons":0,"rank_tier":43,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":510,"pct":0.5263676688023657},"xp_per_min":{"raw":558,"pct":0.299162148841794},"kills_per_min":{"raw":0.0644468313641246,"pct":0.1355347461803844},"last_hits_per_min":{"raw":5.3061224489795915,"pct":0.6623952686052242},"hero_damage_per_min":{"raw":879.7422126745435,"pct":0.5529817644159685},"hero_healing_per_min":{"raw":0,"pct":0.9428289797930015},"tower_damage":{"raw":4986,"pct":0.7841301133563332}}},{"account_id":104476936,"player_slot":131,"team_number":1,"team_slot":3,"hero_id":22,"item_0":180,"item_1":77,"item_2":108,"item_3":1808,"item_4":232,"item_5":37,"backpack_0":0,"backpack_1":0,"backpack_2":0,"item_neutral":336,"kills":7,"deaths":5,"assists":16,"leaver_status":0,"last_hits":102,"denies":8,"gold_per_min":396,"xp_per_min":454,"level":19,"net_worth":17416,"aghanims_scepter":0,"aghanims_shard":0,"moonshard":0,"hero_damage":41004,"tower_damage":825,"hero_healing":322,"gold":2536,"gold_spent":16095,"ability_upgrades_arr":[5110,5111,5111,5110,641,5113,5111,5111,5110,1061,641,5113,641,5110,6157,641,5113],"personaname":"\xd0\xbf\xd1\x83\xd0\xbf\xd1\x81\xd0\xb8\xd0\xba\xd0\xbe\xd0\xb2\xd0\xbe\xd1\x81\xd1\x82\xd1\x8c","name":null,"last_login":"2021-04-04T22:29:50.630Z","radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":false,"win":1,"lose":0,"total_gold":18433,"total_xp":21133,"kills_per_min":0.15037593984962408,"kda":3.83,"abandons":0,"rank_tier":33,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":396,"pct":0.2287454998615342},"xp_per_min":{"raw":454,"pct":0.13209637219606757},"kills_per_min":{"raw":0.15037593984962405,"pct":0.30434782608695654},"last_hits_per_min":{"raw":2.1911922663802366,"pct":0.21406812517308224},"hero_damage_per_min":{"raw":880.859291084855,"pct":0.3946275270008308},"hero_healing_per_min":{"raw":6.917293233082706,"pct":0.9495984491830518},"tower_damage":{"raw":825,"pct":0.5904181667128219}}},{"account_id":56145879,"player_slot":132,"team_number":1,"team_slot":4,"hero_id":123,"item_0":180,"item_1":40,"item_2":141,"item_3":168,"item_4":149,"item_5":596,"backpack_0":140,"backpack_1":0,"backpack_2":0,"item_neutral":288,"kills":7,"deaths":4,"assists":14,"leaver_status":0,"last_hits":120,"denies":6,"gold_per_min":408,"xp_per_min":502,"level":20,"net_worth":19048,"aghanims_scepter":0,"aghanims_shard":1,"moonshard":0,"hero_damage":26547,"tower_damage":4781,"hero_healing":0,"gold":3443,"gold_spent":15385,"ability_upgrades_arr":[8429,8158,8429,8158,8429,8106,8429,9501,8158,9510,9501,8106,8158,9501,9513,9501,8106,7011],"personaname":"Shide","name":null,"last_login":"2021-06-27T11:23:53.986Z","radiant_win":false,"start_time":1704570254,"duration":2793,"cluster":274,"lobby_type":0,"game_mode":22,"is_contributor":false,"patch":54,"region":3,"isRadiant":false,"win":1,"lose":0,"total_gold":18992,"total_xp":23368,"kills_per_min":0.15037593984962408,"kda":4.2,"abandons":0,"rank_tier":32,"is_subscriber":false,"benchmarks":{"gold_per_min":{"raw":408,"pct":0.46754439681567667},"xp_per_min":{"raw":502,"pct":0.31200244947948563},"kills_per_min":{"raw":0.15037593984962405,"pct":0.5419473361910594},"last_hits_per_min":{"raw":2.577873254564984,"pct":0.4265156154317208},"hero_damage_per_min":{"raw":570.2900107411385,"pct":0.5496019595835885},"hero_healing_per_min":{"raw":0,"pct":0.7088181261481935},"tower_damage":{"raw":4781,"pct":0.9200857317819964}}}],"radiant_win":false,"duration":2793,"pre_game_duration":90,"start_time":1704570254,"match_id":7525114514,"match_seq_num":6334736887,"tower_status_radiant":4,"tower_status_dire":1924,"barracks_status_radiant":3,"barracks_status_dire":63,"cluster":274,"first_blood_time":250,"lobby_type":0,"human_players":10,"leagueid":0,"game_mode":22,"flags":1,"engine":1,"radiant_score":33,"dire_score":30,"picks_bans":[{"is_pick":true,"hero_id":22,"team":1,"order":0},{"is_pick":true,"hero_id":55,"team":0,"order":1},{"is_pick":true,"hero_id":74,"team":0,"order":2},{"is_pick":true,"hero_id":64,"team":1,"order":3},{"is_pick":true,"hero_id":123,"team":1,"order":4},{"is_pick":true,"hero_id":56,"team":0,"order":5},{"is_pick":true,"hero_id":41,"team":0,"order":6},{"is_pick":true,"hero_id":12,"team":1,"order":7},{"is_pick":true,"hero_id":99,"team":1,"order":8},{"is_pick":true,"hero_id":107,"team":0,"order":9},{"is_pick":false,"hero_id":30,"team":0,"order":10},{"is_pick":false,"hero_id":26,"team":0,"order":11},{"is_pick":false,"hero_id":2,"team":0,"order":12},{"is_pick":false,"hero_id":11,"team":0,"order":13},{"is_pick":false,"hero_id":71,"team":0,"order":14},{"is_pick":false,"hero_id":113,"team":1,"order":15},{"is_pick":false,"hero_id":10,"team":1,"order":16}],"od_data":{"has_api":true,"has_gcdata":false,"has_parsed":false},"metadata":null,"patch":54,"region":3}'

OPENDOTA_API_KEY = os.getenv("OPENDOTA_API_KEY")


@pytest.mark.skipif(OPENDOTA_API_KEY is None, reason="No OPENDOTA_API_KEY env specified")
@pytest.mark.asyncio
async def test_recent_match():
    opendota = OpenDotaApi(OPENDOTA_API_KEY)
    recent_matches = await opendota.get_player_recent_matches(56145879)
    last_match_id = recent_matches[0].match_id
    match = await opendota.get_match(last_match_id)


@pytest.mark.skipif(OPENDOTA_API_KEY is None, reason="No OPENDOTA_API_KEY env specified")
@pytest.mark.asyncio
async def test_weird_match_player_dump():
    opendota = OpenDotaApi(OPENDOTA_API_KEY)
    match = await opendota.get_match(7563482690)
    for player in match.players:
        data = ctor.dump(player)
        print(data)


def test_opendota_parse_recent_matches():
    data = json.loads(RECENT_MATCHES_DATA)
    ctor.load(list[PlayerRecentMatch], data)


def test_opendota_parse_match():
    data = json.loads(MATCH_DATA)
    try:
        match = ctor.load(DotaMatch, data)
    except ctor.LoadError as e:
        print(data)
        raise
